<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <title>Ajax001</title>
    
    <script 
    src="https://code.jquery.com/jquery-3.4.1.js"
    integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
    crossorigin="anonymous"></script>
    
   <script>

     var token="";

     function login() {

        $.ajax({
            type: "GET",
            crossdomain: true,
            url: "http://localhost:3333/api/auth/login?user=luiz&pwd=123456",
            success: function (result) {
                console.log(result.token);
                token=result.token;
            },
            error: function (xhr, status, err) {
                console.error(xhr, status, err);
            }
        });



     }

     function carrega() {   
        console.log('entrou em carrega')

        $.ajaxSetup({
          headers : {
             'x-access-token' : token
          }
        });

        $.getJSON("http://localhost:3333/api/users", function(data) {
           

           $.each(data, function(chave,linha) {

            var itens = [];
                $.each( linha, function( key, val ) {
                    itens.push( "<td>" + val + "</td>" );
                });
               $('#tabela > tbody:last-child').append("<tr>"+itens.join("")+"</tr>");
           });


        })
        .fail(function(data) { alert("error "+data); console.log(data); })
        
     
     }
   </script>


  </head>
  <body>
     <button onclick="login()">Login</button>

     <p>Este exemplo demonstra o uso de JQuery com Ajax:</p>
     <button onclick="carrega()">Busca dados</button>
     <table id="tabela">
         <thead>
             <tr>
                 <td>ID</td>
                 <td>USUARIO</td>
                 <td>NOME</td>   
             </tr>
         </thead>
         <tbody>

         </tbody>
     </table>
  </body>
</html>
